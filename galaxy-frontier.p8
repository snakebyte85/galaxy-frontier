pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
#include constants.lua
#include util.lua
#include timer.lua
#include entity.lua
#include projectiles.lua
#include enemy.lua
#include player.lua
#include particles.lua
#include space.lua
#include ui.lua
#include game.lua
#include title.lua
#include summary.lua
#include splash.lua
#include levels.lua

global={
   debug=false,
   log=false,
   state="splash",
   states={
      game={
         init=game_init,
         dispose=game_dispose,
         update=game_update,
         draw=game_draw
      },
      title={
         init=title_init,
         dispose=title_dispose,
         update=title_update,
         draw=title_draw
      },
      splash={
         init=splash_init,
         dispose=splash_dispose,
         update=splash_update,
         draw=splash_draw
      },
      summary={
         init=summary_init,
         dispose=summary_dispose,
         update=summary_update,
         draw=summary_draw
      }
   },
   transition_step=0,
   transition_reset_screen=false
}

function change_state(new_state, transition_type)

   args = args or {}

   if transition_type == "wipe_to_black" then
      global.transition_step=0
      create_timer(0.02,function() 
                      global.transition_step = global.transition_step + 1
      end, {}, 64, function()                
                      global.transition_step=0
                      global.transition_reset_screen=true
                      global.states[global.state].dispose()
                      global.state=new_state
                      global.states[new_state].init()
      end)

   elseif transition_type == "wipe_to_black_to_state" then
      global.transition_step=0
      create_timer(0.02,function() 
                      global.transition_step = global.transition_step + 1
      end, {}, 64, function()  
                      global.states[global.state].dispose()
                      global.state=new_state
                      global.states[new_state].init()
                      create_timer(0.02,function() 
                                      global.transition_step = global.transition_step - 1
                      end, {}, 64, function()                         
                                      global.transition_step=0
                                      global.transition_reset_screen=true
                      end)                         
      end)
   else
      global.states[global.state].dispose()
      global.state=new_state
      global.states[new_state].init()
   end
end

function _init()
   change_state(global.state)
end

function _update60()
   timers_update()
   global.states[global.state].update()
end

function _draw()

   cls()

   if global.debug then
      rect(0,0,const.screen.max_x-1,const.screen.max_y-1, const.colors.red)
   end


   if global.transition_step > 0 then
      clip(global.transition_step,global.transition_step,
           const.screen.max_x-(2*global.transition_step),
           const.screen.max_y-(2*global.transition_step))
   end
   
   if global.transition_reset_screen then
      clip()
      global.transition_reset_screen = false
   end

   global.states[global.state].draw()

end

__gfx__
0000000000011000000110000001100000cccc0000cccc0000cccc0000cccc000033330000333300003333000011110000111100000000000000000000000000
00000000b071170bb071170bb071170b0cccccc00cccc8c00cccccc00cc778c003333330033aa330033333300111111001111110000a90000009a00000000000
00700700707777077077770770777707cc1111cccc11888cccc11ccccc77888c3388883333a33a333366333311b11b111b1bb1b100aa99000099aa0000000000
00077000777777777777777777777777cc1661cccc1668cccbc77cbccc7778cc388aaa833a3333a33a66668311b11b111b1bb1b100aa99000099aa0000000000
00077000077777700777777007777770cc1661cccc1661ccc777777cccaaaacc88aaaa833a3333a33a66668311b11b111b1bb1b100aa99000099aa0000000000
00700700007777000077770000777700cc1661cccc1661cccc7777ccccc99ccc388aaa8333a33a333366333311b11b111b1bb1b1000a90000009a00000000000
0000000000077000000aa00000a99a000cc11cc00cc11cc00cc77cc00cc99cc003888830033aa330033333300111111001111110000000000000000000000000
0000000000000000000000000009900000cccc0000cccc0000cccc0000cccc000033330000333300003333000011110000111100000000000000000000000000
00000000005555000550055033000033000000000000000000000000000000000000000000000000000000000000000000000000000888000000000000000000
00066000000550005500005503333330000000000000000000000000000000000000000000000000000800000008000000000000008aaa800000000000000000
006666005008800550588505033bb330000d10000001d00000000000000000000000000000000000000600000006000000088000008aaa800000000000000000
066cc660558888550088880033bbbb3300111d0000d11100000000000000000000000000000000000006000000060000008aa800008aaa800000000000000000
06666660558888550088880033bbbb3300d1110000111d00000000000000000000000000000000000066600000666000008aa8000088a8800000000000000000
006006005008800550588505033bb3300001d000000d100000000000000000000000000000000000000a000000aaa00000088000000888000000000000000000
00800800000550005500005500333300000000000000000000000000000000000000000000000000000000000009000000000000000080000000000000000000
00000000005555000550055003300330000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000110000110000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00011dd1111dd1111dd1100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0011dddd11dddd11dddd110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00011dd1111dd1111dd1100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000110011cc1100110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000880001cc1000880000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000001cc1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000110000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000000017777100000000000000000dddddddd000000000000000000000000999999990000000000000000000000000000000000000000000000000000
000000000001111771111000000000000dddddddddddddd000000000000000000999999999999990000000000000000000000000000000000000000000000000
0000000000111113331111000000000dddddddddddddddddd0000000000000099999aaaaaaaa9999900000000000000000000000000000000000000000000000
000000000111111333311110000000dddddddddddddddddddd000000000000999aaaaaaaaaaaaaa9990000000000000000000000000000000000000000000000
000000000131133333311130000009ddddddddddddddddddddd0000000000999aaaaaaaaaaaaaaaa999000000000000000000000000000000000000000000000
0000000013311333333333310000999ddddddddddddddddddddd0000000099aaaaaaaaaaaaaaaaaaaa9900000000000000000000000000000000000000000000
0000000033331199993333330009999999ddddd999999ddddd99900000099aaaaaaaaaaaaaaaaaaaaaa990000000000000000000000000000000000000000000
0000000033331119999199330099999999999999999999999999990000999aaaaaaaaaaaaaaaaaaaaaa999000000000000000000000000000000000000000000
000000009933111993319999009999999999999999999999999999000099aaaaaaaaaaaaaaaaaaaaaaaa99000000000000000000000000000000000000000000
00000000199111133311399304499999999999999999999999999990099aaaaaaaaaaaaaaaaaaaaaaaaaa9900000000000000000000000000000000000000000
00000000199311113311133304449999999999999999999999999990099aaaaaaaaaaaaaaaaaaaaaaaaaa9900000000000000000000000000000000000000000
00000000013311311111133004444999999999999999999999999990099aaaaaaaaaaaaaaaaaaaaaaaaaa9900000000000000000000000000000000000000000
0000000001111333111113306644444999999999999999999999994499aaaaaaaaaaaaaaaaaaaaaaaaaaaa990000000000000000000000000000000000000000
0000000000111111111111006664444444499999999999999999444499aaaaaaaaaaaaaaaaaaaaaaaaaaaa990000000000000000000000000000000000000000
0000000000011177771110006666644444444444444444444444444699aaaaaaaaaaaaaaaaaaaaaaaaaaaa990000000000000000000000000000000000000000
0000000000000777777000006666664444444444444444444444466699aaaaaaaaaaaaaaaaaaaaaaaaaaaa990000000000000000000000000000000000000000
0000000000000555666000006666666666666666644466666466666699aaaaaaaaaaaaaaaaaaaaaaaaaaaa990000000000000000000000000000000000000000
0000000000066556666660006666666666666666666666666666666699aaaaaaaaaaaaaaaaaaaaaaaaaaaa990000000000000000000000000000000000000000
0000000000666666666666006666666666666666666666666666666699aaaaaaaaaaaaaaaaaaaaaaaaaaaa990000000000000000000000000000000000000000
0000000006666666665566606666666666666666666666666666666699aaaaaaaaaaaaaaaaaaaaaaaaaaaa990000000000000000000000000000000000000000
00000000056666666555566006666666666666666666666666666660099aaaaaaaaaaaaaaaaaaaaaaaaaa9900000000000000000000000000000000000000000
00000000556655666555566606666666666666666666666666666660099aaaaaaaaaaaaaaaaaaaaaaaaaa9900000000000000000000000000000000000000000
00000000556555566655666606666666644444444444444444666660099aaaaaaaaaaaaaaaaaaaaaaaaaa9900000000000000000000000000000000000000000
000000005665555666666666006444444444444444444444444444000099aaaaaaaaaaaaaaaaaaaaaaaa99000000000000000000000000000000000000000000
0000000066665566666666550044444444444444444444444444440000999aaaaaaaaaaaaaaaaaaaaaa999000000000000000000000000000000000000000000
0000000066666666655666550004444999999999999999994444400000099aaaaaaaaaaaaaaaaaaaaaa990000000000000000000000000000000000000000000
00000000666666665555666500009999999999999999999999940000000099aaaaaaaaaaaaaaaaaaaa9900000000000000000000000000000000000000000000
0000000005666666555566600000099999999999999999999990000000000999aaaaaaaaaaaaaaaa999000000000000000000000000000000000000000000000
00000000056666666556666000000099999999999999999999000000000000999aaaaaaaaaaaaaa9990000000000000000000000000000000000000000000000
0000000000666666666666000000000999ddddddddd9999990000000000000099999aaaaaaaa9999900000000000000000000000000000000000000000000000
000000000006555666666000000000000dddddddddddddd000000000000000000999999999999990000000000000000000000000000000000000000000000000
000000000000055666600000000000000000dddddddd000000000000000000000000999999990000000000000000000000000000000000000000000000000000
__sfx__
000f00000000000000020000200019000010000000000000000000000001000010000100002000030000300003000040000400004000040000300002000020000100001000000000000000000000000000000000
001000001800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
